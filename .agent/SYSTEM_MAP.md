---
Назва: Системна карта (Slovko)
Опис: Огляд архітектури проекту, зокрема логіки гри (MVC).
Тип: Документація
Дати: Створено 2026-02-05, Оновлено 2026-02-05
---

# Системна карта (Slovko)

## Огляд

Цей документ описує ключові архітектурні компоненти проекту Slovko, зосереджуючись на рівні логіки гри, який було рефакторизовано за шаблоном Model-View-Controller (MVC).

## Основна архітектура (Гра)

### 1. View (UI Компоненти)

Відповідає за відображення стану гри та обробку вводу користувача.

- **`src/lib/components/game/GameBoard.svelte`**: Основний контейнер гри. Відображає картки та макет.
- **`src/lib/components/game/WordCard.svelte`**: Компонент окремої картки.
- **`src/lib/components/game/GameStats.svelte`**: Панель статистики (серія, точність) та кнопки керування (підказка, режим навчання).
- **`src/lib/components/game/CardContextMenu.svelte`**: Контекстне меню для додаткових дій (прослухати, додати в обране).

**Взаємодія:** Компоненти *читають* дані з `gameState` (Store) та *викликають* методи `gameController` (Controller).

### 2. Model (Сховище стану)

Відповідає за збереження поточного стану гри у чистому, реактивному вигляді.

- **`src/lib/stores/gameState.svelte.ts`**:
  - **Тип:** Svelte 5 Runes Store.
  - **Відповідальність:** Зберігає `sourceCards`, `targetCards`, `stats`, `isLoading` тощо.
  - **Шаблон:** Passive Data Store (Пасивне сховище даних). Містить сетери/оновлювачі, але НЕ містить бізнес-логіки (наприклад, правил гри).
  - **API:** `setCards`, `updateCardStatus`, `recordMatch`, `getAvailableWords`.

### 3. Controller (Логіка гри)

Відповідає за координацію ігрового процесу, дотримання правил та керування побічними ефектами.

- **`src/lib/services/gameController.ts`**:
  - **Відповідальність:**
    - `initGame()`: Оркеструє завантаження даних та початкове налаштування.
    - `selectCard()`: Обробляє кліки користувача, логіку співпадіння/помилки.
    - `handleMatch()` / `handleMiss()`: Оновлює рахунок, відтворює звук.
    - `checkAndRefill()`: Моніторить стан ігрового поля для додавання нових слів.
    - `useHint()` / `runLearningLoop()`: Логіка автоматизації.
  - **Залежності:** Використовує `gameState` для оновлення вигляду, `gameDataService` для отримання даних, `gameAudioHandler` для звуку.

### 4. Сервіси (Інфраструктура)

Допоміжні сервіси, що забезпечують специфічні можливості домену.

- **`src/lib/services/gameDataService.ts`**: Уніфікований завантажувач даних (переклади, транскрипції).
- **`src/lib/services/gameAudioHandler.ts`**: Керує відтворенням аудіо для ігрових подій.
- **`src/lib/services/gameFeedbackHandler.ts`**: Керує збереженням прогресу (серії, помилки) та оновленням зовнішніх сховищ.
- **`src/lib/data/wordService.ts`**: Низькорівневий завантажувач JSON (планується об'єднання з gameDataService).

## Потік даних (Data Flow)

1.  **Дія користувача:** Користувач клікає на картку в `GameBoard`.
2.  **Контролер:** Викликається `gameController.selectCard(card)`.
3.  **Логіка:** Контролер перевіряє `gameState` на наявність `selectedCard`.
    - Якщо перший вибір: Викликає `gameState.setSelectedCard(card)`.
    - Якщо другий вибір: Перевіряє співпадіння.
4.  **Оновлення:**
    - **Співпадіння:** Контролер викликає `gameState.updateCardStatus('correct')`, програє звук, оновлює статистику.
    - **Помилка:** Контролер викликає `gameState.updateCardStatus('wrong')`, скидає вибір після затримки.
5.  **Реактивне оновлення:** `gameState` оновлює rune-значення -> Svelte автоматично перемальовує `GameBoard`.

## Ключові файли та розташування

| Компонент      | Шлях                                       | Опис                         |
| :------------- | :----------------------------------------- | :--------------------------- |
| **Сховище**    | `src/lib/stores/gameState.svelte.ts`       | "База даних" фронтенду.      |
| **Контролер**  | `src/lib/services/gameController.ts`       | "Мозок" гри.                 |
| **Вигляд**     | `src/lib/components/game/GameBoard.svelte` | "Обличчя" гри.               |

## Майбутні покращення

- Об'єднати `wordService` та `gameDataService`.
- Додати строгий автомат станів (state machine) для `CardStatus`.
