---
name: Feature - Active Search & Enhanced User Discovery
description: –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É "–ê–∫—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫" (Discovery Mode) —Ç–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è UX –ø–æ—à—É–∫—É –¥—Ä—É–∑—ñ–≤ –∑–∞ Email.
type: plan
status: 100%
created: 2026-02-06
updated: 2026-02-06
---

# üéØ –ú–µ—Ç–∞
–°–ø—Ä–æ—Å—Ç–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥—Ä—É–∑—ñ–≤, —É—Å—É–Ω—É–≤—à–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥—É Email, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –ø–æ—Ä—É—á –∞–±–æ –¥–æ–º–æ–≤–ª—è—é—Ç—å—Å—è –ø—Ä–æ –≥—Ä—É. –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –±–µ–∑–ø–µ–∫—É –ø–æ—à—É–∫—É, –æ–±–º–µ–∂–∏–≤—à–∏ –π–æ–≥–æ –ª–∏—à–µ —Ç–æ—á–Ω–∏–º –∑–±—ñ–≥–æ–º –ø–æ—à—Ç–∏.

# üìã –í–∏–º–æ–≥–∏ (User Stories)

1. **–¢–æ—á–Ω–∏–π –ø–æ—à—É–∫ –ø–æ Email:**
   - –Ø —Ö–æ—á—É –±–∞—á–∏—Ç–∏ –≤ –ø–æ–ª—ñ –ø–æ—à—É–∫—É –ø—ñ–¥–∫–∞–∑–∫—É, —â–æ —à—É–∫–∞—Ç–∏ –º–æ–∂–Ω–∞ –ª–∏—à–µ –∑–∞ —Ç–æ—á–Ω–æ—é –ø–æ—à—Ç–æ—é.
   - –Ø —Ö–æ—á—É –º–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–í—Å—Ç–∞–≤–∏—Ç–∏" (Paste) –±—ñ–ª—è –ø–æ–ª—è, —â–æ–± –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–∏–π Email –æ–¥–Ω–∏–º –∫–ª—ñ–∫–æ–º.
   - –ü–æ—à—É–∫ –∑–∞ —á–∞—Å—Ç–∫–æ–≤–∏–º —ñ–º'—è–º –º–∞—î –±—É—Ç–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–∏–π (–∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–π –≤ –∫–æ–¥—ñ) –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —ñ–º–ø–µ—Ä—Å–æ–Ω–∞—Ü—ñ—ó.

2. **–ê–∫—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫ (Discovery Mode):**
   - –Ø —Ö–æ—á—É –º–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–ê–∫—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫".
   - –ö–æ–ª–∏ —è —ó—ó –Ω–∞—Ç–∏—Å–∫–∞—é, —è —Å—Ç–∞—é –≤–∏–¥–∏–º–∏–º –¥–ª—è —ñ–Ω—à–∏—Ö, —Ö—Ç–æ —Ç–µ–∂ –Ω–∞—Ç–∏—Å–Ω—É–≤ —Ü—é –∫–Ω–æ–ø–∫—É.
   - –Ø –±–∞—á—É —Å–ø–∏—Å–æ–∫ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –∑–∞—Ä–∞–∑ –≤ —Ä–µ–∂–∏–º—ñ "–ê–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—à—É–∫—É".
   - –Ø –º–æ–∂—É –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ "–î–æ–¥–∞—Ç–∏" –±—ñ–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å–ø–∏—Å–∫—É.
   - –ö–æ–ª–∏ —è –∑–∞–∫—Ä–∏–≤–∞—é –≤—ñ–∫–Ω–æ –ø–æ—à—É–∫—É, —è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∏–∫–∞—é –∑—ñ —Å–ø–∏—Å–∫—É "–ê–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—à—É–∫—É".

# üèó –¢–µ—Ö–Ω—ñ—á–Ω–∞ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

## 1. Realtime Database (RTDB) - `discovery/`
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ RTDB –∑–∞–º—ñ—Å—Ç—å Firestore –¥–ª—è —Ü—å–æ–≥–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É, –æ—Å–∫—ñ–ª—å–∫–∏ –¥–∞–Ω—ñ –µ—Ñ–µ–º–µ—Ä–Ω—ñ (–∂–∏–≤—É—Ç—å —Å–µ–∫—É–Ω–¥–∏/—Ö–≤–∏–ª–∏–Ω–∏) —ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –º–∏—Ç—Ç—î–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö:**
```json
{
  "discovery": {
    "uid1": {
      "displayName": "User Name",
      "photoURL": "url...",
      "timestamp": 1700000000
    },
    "uid2": { ... }
  }
}
```

## 2. DiscoveryService (New)
–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —Å–µ—Ä–≤—ñ—Å (–∞–±–æ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ `PresenceService`), —è–∫–∏–π –∫–µ—Ä—É–≤–∞—Ç–∏–º–µ —Å—Ç–∞–Ω–æ–º "–≤–∏–¥–∏–º–æ—Å—Ç—ñ".
- `enterDiscoveryMode()`: –ó–∞–ø–∏—Å—É—î –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ `discovery/{uid}` + –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `onDisconnect().remove()`.
- `leaveDiscoveryMode()`: –í–∏–¥–∞–ª—è—î –¥–∞–Ω—ñ –∑ `discovery/{uid}`.
- `subscribeToDiscovery(callback)`: –°–ª—É—Ö–∞—î –∑–º—ñ–Ω–∏ –≤ `discovery/` (–∑ –ª—ñ–º—ñ—Ç–æ–º, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ—Å—Ç–∞–Ω–Ω—ñ 20-30 –∑–∞–ø–∏—Å—ñ–≤ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ).

## 3. FriendsService (Update)
- –ú–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥ `searchUsers`:
  - –ó–∞–∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –ø–æ—à—É–∫—É –ø–æ `displayName`.
  - –ó–∞–ª–∏—à–∏—Ç–∏/–æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø–æ—à—É–∫ –ø–æ `email`.

## 4. UI Components (`UserSearch.svelte`)
- –û–Ω–æ–≤–∏—Ç–∏ `placeholder`.
- –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫—É `Paste` (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `navigator.clipboard`).
- –î–æ–¥–∞—Ç–∏ —Å–µ–∫—Ü—ñ—é "–ê–∫—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫":
  - Toggle –∫–Ω–æ–ø–∫–∞ (–í–∫–ª/–í–∏–∫–ª).
  - –ê–Ω—ñ–º–∞—Ü—ñ—è "—Ä–∞–¥–∞—Ä—É" (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ).
  - –°–ø–∏—Å–æ–∫ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (Card/List item) –∑ –∫–Ω–æ–ø–∫–æ—é "–î–æ–¥–∞—Ç–∏".
  - –õ–æ–≥—ñ–∫–∞ `onMount` / `onDestroy` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ–≥–æ –≤–∏—Ö–æ–¥—É –∑ —Ä–µ–∂–∏–º—É –ø–æ—à—É–∫—É.

# üìÖ –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

| –ö—Ä–æ–∫ | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å |
|------|--------|------|
| 1 | **FriendsService Update** | –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø–æ—à—É–∫ –ø–æ —ñ–º–µ–Ω—ñ, –∑–∞–ª–∏—à–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Ç–æ—á–Ω–∏–π Email. |
| 2 | **DiscoveryService** | –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ –≤—Ö–æ–¥—É/–≤–∏—Ö–æ–¥—É —Ç–∞ –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ `discovery` –≤ RTDB. |
| 3 | **UI: Search Input** | –û–Ω–æ–≤–∏—Ç–∏ —Ç–µ–∫—Å—Ç, –¥–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫—É Paste. |
| 4 | **UI: Active Search** | –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ DiscoveryService –≤ `UserSearch.svelte`, –¥–æ–¥–∞—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É. |
| 5 | **Security & Cleanup** | –ì–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –ø–æ—à—É–∫—É –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª–∫–∏, –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∞–±–æ –≤—Ç—Ä–∞—Ç—ñ –∑–≤'—è–∑–∫—É. |

# üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞
- **Privacy:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ —Å–ø–∏—Å–æ–∫ `discovery` *—Ç—ñ–ª—å–∫–∏* –∑–∞ –≤–ª–∞—Å–Ω–æ—é —è–≤–Ω–æ—é –¥—ñ—î—é.
- **Data Leak:** –î–∞–Ω—ñ –≤ `discovery` –º—ñ—Å—Ç—è—Ç—å –ª–∏—à–µ –ø—É–±–ª—ñ—á–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å (—ñ–º'—è, —Ñ–æ—Ç–æ). Email –Ω–µ —Ä–æ–∑–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –ø—É–±–ª—ñ—á–Ω–æ –≤ —Ü—å–æ–º—É —Å–ø–∏—Å–∫—É (–∫–Ω–æ–ø–∫–∞ "–î–æ–¥–∞—Ç–∏" –ø—Ä–∞—Ü—é—î –ø–æ UID).
- **Impersonation:** –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–æ—à—É–∫—É –ø–æ —ñ–º–µ–Ω—ñ —É—Å—É–≤–∞—î —Ä–∏–∑–∏–∫ –∑–Ω–∞–π—Ç–∏ "—Ñ–µ–π–∫–æ–≤–æ–≥–æ" –¥—Ä—É–≥–∞.
