# –í—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å: –ü—Ä–æ–±–ª–µ–º–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è PresenceService (Status Subscriptions)

## üìù –û–ø–∏—Å
–£ —Ñ–∞–π–ª—ñ `src/routes/+layout.svelte` –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ —Ñ–æ–Ω–æ–≤–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ —É—Å—ñ—Ö –≤–∑–∞—î–º–Ω–∏—Ö –¥—Ä—É–∑—ñ–≤:
```typescript
$effect(() => {
    const mutuals = friendsStore.mutualFriends;
    const unsubs = mutuals.map(friend => PresenceService.trackFriendStatus(friend.uid));
    return () => unsubs.forEach(unsub => unsub());
});
```
–ö–æ–∂–µ–Ω –≤–∏–∫–ª–∏–∫ `trackFriendStatus` —Å—Ç–≤–æ—Ä—é—î –æ–∫—Ä–µ–º–∏–π `onValue` —Å–ª—É—Ö–∞—á —É Realtime Database.

## üî¥ –†–∏–∑–∏–∫–∏
1. **–†–µ—Å—É—Ä—Å–∏ –∫–ª—ñ—î–Ω—Ç–∞:** –Ø–∫—â–æ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ 100+ –≤–∑–∞—î–º–Ω–∏—Ö –¥—Ä—É–∑—ñ–≤, –¥–æ–¥–∞—Ç–æ–∫ –≤—ñ–¥–∫—Ä–∏—î 100+ –∞–∫—Ç–∏–≤–Ω–∏—Ö WebSocket-–ø—ñ–¥–ø–∏—Å–æ–∫. –¶–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç—å –∑–Ω–∞—á–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ CPU —Ç–∞ –∞–∫—É–º—É–ª—è—Ç–æ—Ä.
2. **–õ—ñ–º—ñ—Ç–∏ Firebase:** –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ —Ç–∞ –Ω–∞–≤—ñ—Ç—å –ø–ª–∞—Ç–Ω—ñ –ø–ª–∞–Ω–∏ Firebase –º–∞—é—Ç—å –ª—ñ–º—ñ—Ç–∏ –Ω–∞ –æ–¥–Ω–æ—á–∞—Å–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è (Simultaneous connections). –ú–∞—Å–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞–∫–æ—ó —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –≤—Å—ñ–º–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –º–æ–∂–µ —à–≤–∏–¥–∫–æ –≤–∏—á–µ—Ä–ø–∞—Ç–∏ –∫–≤–æ—Ç–∏.
3. **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å UI:** –ö–æ–∂–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –±—É–¥—å-—è–∫–æ–≥–æ –¥—Ä—É–≥–∞ –≤–∏–∫–ª–∏–∫–∞—î —Ä–µ–∞–∫—Ç–∏–≤–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ `friendsStatus`, —â–æ –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω—è—Ç–∏ –º—ñ–∫—Ä–æ-—Ñ—Ä–∏–∑–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.

## üõ† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
1. **–õ—ñ–Ω–∏–≤–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è:** –ü—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏—Å—è –Ω–∞ —Å—Ç–∞—Ç—É—Å –ª–∏—à–µ —Ç–æ–¥—ñ, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑—ñ–≤.
2. **–û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ:** –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å —Ç—ñ–ª—å–∫–∏ –¥–ª—è –¢–û–ü-10 –∞–±–æ –¢–û–ü-20 –Ω–∞–π–∞–∫—Ç–∏–≤–Ω—ñ—à–∏—Ö –¥—Ä—É–∑—ñ–≤.
3. **Batching (—è–∫—â–æ –º–æ–∂–ª–∏–≤–æ):** Realtime Database –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –Ω–∞—Ç–∏–≤–Ω–µ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è `onValue` –∑–∞ —Å–ø–∏—Å–∫–æ–º ID, —Ç–æ–º—É –Ω–∞–π–∫—Ä–∞—â–∏–º —Ä—ñ—à–µ–Ω–Ω—è–º —î —Å–∞–º–µ –ª—ñ–Ω–∏–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
